# Shared configuration for all workflows.
#
# This reusable workflow provides common values to avoid duplication:
# - Build targets (2-platform matrix: ubuntu-latest, macos-15)
# - Version configuration (Python, Node.js, Rust)
# - Artifact retention settings
name: Config

on:
  workflow_call:
    outputs:
      # === Platform/Matrix Configuration ===
      platforms:
        description: 'JSON array of platform configurations (os and target)'
        value: ${{ jobs.config.outputs.platforms }}

      # === Version Configuration ===
      python-versions:
        description: 'JSON array of Python versions to test'
        value: ${{ jobs.config.outputs.python-versions }}
      node-versions:
        description: 'JSON array of Node.js versions to test'
        value: ${{ jobs.config.outputs.node-versions }}
      node-build-version:
        description: 'Node.js version for building'
        value: ${{ jobs.config.outputs.node-build-version }}
      rust-toolchain:
        description: 'Rust toolchain version'
        value: ${{ jobs.config.outputs.rust-toolchain }}

      # === Artifact Configuration ===
      artifact-retention-days:
        description: 'Number of days to retain artifacts'
        value: ${{ jobs.config.outputs.artifact-retention-days }}

jobs:
  config:
    name: Load configuration
    runs-on: ubuntu-latest
    outputs:
      # === Platform/Matrix Configuration ===
      # Note: Using macos-15 for libkrun bottle compatibility (arm64_tahoe)
      platforms: '[{"os":"macos-15","target":"darwin-arm64"},{"os":"ubuntu-latest","target":"linux-x64-gnu"}]'

      # === Version Configuration ===
      python-versions: '["3.10", "3.11", "3.12", "3.13"]'
      node-versions: '["18", "20", "22"]'
      node-build-version: '20'
      rust-toolchain: 'stable'

      # === Artifact Configuration ===
      artifact-retention-days: '7'

    steps:
      - run: echo "Configuration loaded"
